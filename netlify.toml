# ARQUIVO: netlify.toml

[build]
  command = "npm run build"
  publish = "dist"

[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

# --- Edge Functions (Middleware) ---
[[edge_functions]]
  function = "auth-protect"
  path = "/admin/*"

[[edge_functions]]
  function = "auth-protect"
  path = "/dashboard/*"

[[edge_functions]]
  function = "auth-protect"
  path = "/atacado/*"

# --- REDIRECTS (A ORDEM IMPORTA MUITO) ---

# 1. API: Manda pro backend (Serverless Functions)
# Isso TEM que vir antes da regra do SPA
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# 2. Auth: Deixa o Supabase resolver sozinho
[[redirects]]
  from = "/auth/*"
  to = "https://jphprbjcmhpeqwolzntq.supabase.co/:splat"
  status = 200
  force = true

# 3. SPA (Single Page App): O "Catch-All"
# SÃ³ executa se nenhuma das regras acima bater
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200